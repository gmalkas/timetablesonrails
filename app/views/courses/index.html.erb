<% title @active_school_year %>

<header>
  <h1><%= @active_school_year %> / Unités d'enseigments</h1>
</header>

<%# <aside class="teacher_card"> %>
<%#   <img class="close_card" src="assets/x_alt_16x16.png" /> %>
<%#   <header> %>
<%# 		<h1>Marin Bertier</h1> %>
<%# 		<h2 style="font-size: 0.75em; letter-spacing: 0;">Enseignant-Chercheur</h2> %>
<%# 	</header> %>
<%# 	<p class="contact_information"> %>
<%# 		<img src="assets/iphone_12x16.png" alt="Email" /> +33 (0)2 23 23 86 79<br /> %>
<%# 		<img src="assets/at_16x16.png" alt="Email" /> marin.bertier@irisa.fr<br /> %>
<%# 	</p> %>
<%# 	<h3> %>
<%# 	 Responsabilités %>
<%# 	</h3> %>
<%# 	<p> %>
<%# 		&raquo; <a href="">C#</a> &raquo; <a href="">Systèmes d'exploitation</a> %>
<%# 	</p> %>
<%# </aside> %>

<%= render 'shared/flash_messages' %>

<section class="filters">
  Filtrer par &raquo;
  <ul>
    <li style="font-weight: bold;">Semestre</li>
    <li><%= link_to "Statut", root_path %></li>
    <li><%= link_to "Responsable", root_path %></li>
  </ul>
</section>

<section class="semesters">

  <% @semesters.each do |sem| %>

    <article class="semester">
      <section class="new-course" style="float: right;">
        <div class="add-course">
          <%= link_to "Ajouter une U.E &rarr;".html_safe, root_path, :class => 'show_form' %>
        </div>
      </section>

      <h2>Semestre <%= sem.name %></h2>
    
      <% @course_semester = @course.semester_id == sem.id %> 
      <% if @course.errors.any? && @course_semester %>
        <p class="error">
          <% @course.errors[:name].each do |e| %>
            <strong class="error"><%= @course.errors.full_message(:name, e) %></strong><br />
          <% end %>
        </p>
      <% end %>

      <%= form_for @course, html: { class: 'inline-form new-course-form', style: @course_semester ? 'display: block;' : '' } do |f| %>
        <div class="fields">
          <div class="field">
            <%= f.text_field :name, placeholder: "Nom de l'unité" %>
            <%= hidden_field_tag :semester_id, sem.id %>
            <%= f.submit "Créer &rarr;".html_safe %>ou <a href="" class="cancel">annuler</a> 
          </div>
        </div>
      <% end %>

    <% if sem.courses.empty? %>
      <p class="notice">Aucune matière n'a été ajoutée à ce semestre.</p>
    <% else %>
      <div class="courses">

        <% sem.courses.each do |course| %>

          <% css_class = (course.conflict?) ? "warning" : (course.candidates.count > 0 || course.assigned? ) ? "valid" : "nobody" %>
          <% img_prefix = (css_class == "warning" || css_class == "valid") ? "white_" : "" %>
          <article class="course <%= css_class %>">
            <a href="" class="plus"><img src="assets/<%= img_prefix %>plus_alt_16x16.png" alt="+" /></a>
            <h3><%= course.name %></h3>

            <p class="informations">
              <% if course.candidates.empty? %>
                <% if course.assigned? %>
                  <%= course.manager.name %>
                <% else %>
                  <em>Aucun postulant</em>
                <% end %>
              <% else %>
                <%= pluralize(course.candidates.count, "postulant") %>
              <% end %>
            </p>

            <div class="details" style="background-color: #FAFAFA; border-radius: 6px; padding: 0.5em; margin-top: 0.5em;">
              <p style="padding: 0.5em;" class="postulants">
                <% if course.candidates.empty? %>
                  <% if not course.assigned? %>
                    <em>Aucun postulant</em>
                  <% end %>
                <% else %>
                  <ul>
                    <% course.candidates.each do |p| %>
                      <li>
                        <%= link_to p.name, root_path, :class => 'show_teacher_card' %>
                        <span class="actions" style="font-size: 0.875em; opacity: 0.7;">
                          (
                          <%= link_to "Désigner responsable", choose_course_manager_path(course, p), method: :post %>
                          <%= link_to "Supprimer de la liste", dismiss_candidate_path(course, p), method: :post %>
                          )
                        </span>
                      </li>
                    <% end %>
                  </ul>
                <% end %>
              </p>
              <p class="course-actions <%= css_class %>">
                <a href="" class="button icon edit">Modifier</a>
                <%= link_to "Supprimer", course, method: :delete, confirm: "Êtes-vous sûr de vouloir supprimer ce cours ? Toutes les données associées seront perdues !", class: "button icon trash" %>
              </p>
            </div>
            
          </article>
        <% end %>

      </div>
    <% end %>
    </article>
  <% end %>
  </div>
</section>
